function ttrCalculation() {
    var inrRangeArr = inrRange.trim().split("-");
    var lowRange = parseInt(inrRangeArr[0].trim());
    var highRange = parseInt(inrRangeArr[1].trim());

    console.log("low", lowRange, "high", highRange);

    let _daysSinceLastTest = 0;
    let _inrDiff = 0;
    let _previousInrWithinRange = "";
    let _currentInrWithinRange = "";
    let _scenario = "";
    let _inrDiffAboveRange = 0;
    let _inrDiffWithinRange = 0;
    let _inrDiffBelowRange = 0;
    let _daysWithinRangeSinceLastTest = 0;
    let _percentageDaysWithinRangeSinceLastTest = 0;

    let previousRecord = patientState.bloodThinner.inrRecord
      ? patientState.bloodThinner.inrRecord[
          patientState.bloodThinner.inrRecord.length - 1
        ]
      : {};

    if (previousRecord === undefined) {
      // if (inr < lowRange) _currentInrWithinRange = "Below";
      // else if (inr > highRange) _currentInrWithinRange = "Above";
      // else _currentInrWithinRange = "In Range";
      if (inr < lowRange) _currentInrWithinRange = "Below";
      else if (inr > highRange) _currentInrWithinRange = "Above";
      else _currentInrWithinRange = "In Range";

      setCurrentInrWithinRange(_currentInrWithinRange);
      console.log("Current inr within range", _currentInrWithinRange);
      console.log("Current inr within range", currentInrWithinRange);
    } else {
      console.log("previous record", previousRecord);
      console.log("inr", inr);
      console.log("date", date);
      console.log("pdate", previousRecord.date);

      // Days Since Last Test
      let diff =
        new Date(date).getTime() - new Date(previousRecord.date).getTime();
      _daysSinceLastTest = Math.ceil(diff / (1000 * 3600 * 24));
      // INR Diff
      _inrDiff = Math.round((inr - previousRecord.inr) * 10) / 10;
      // Previous INR Within Range
      _previousInrWithinRange = previousRecord.currentInrWithinRange;
      // Current INR Within Range
      if (inr < lowRange) _currentInrWithinRange = "Below";
      else if (inr > highRange) _currentInrWithinRange = "Above";
      else _currentInrWithinRange = "In Range";
      // Scenario
      _scenario =
        _previousInrWithinRange.localeCompare(_currentInrWithinRange) === 0
          ? _previousInrWithinRange
          : "Calculate";
      // INR Diff Above Range
      if (_scenario.localeCompare("Above") === 0) {
        _inrDiffAboveRange = Math.abs(inrDiff);
      } else if (_previousInrWithinRange.localeCompare("Above") === 0) {
        _inrDiffAboveRange = Math.abs(previousRecord.inr - highRange);
      } else if (_currentInrWithinRange.localeCompare("Above") === 0) {
        _inrDiffAboveRange = Math.abs(inr - highRange);
      }
      // INR Diff Within Range
      _inrDiffWithinRange = parseFloat(
        Math.abs(_inrDiff) -
          Math.abs(_inrDiffAboveRange) -
          Math.abs(_inrDiffBelowRange)
      ).toFixed(1);
      // INR Diff Below Range
      if (_scenario.localeCompare("Below") === 0) {
        _inrDiffBelowRange = Math.abs(inrDiff);
      } else if (_previousInrWithinRange.localeCompare("Below") === 0) {
        _inrDiffBelowRange = Math.abs(previousRecord.inr - lowRange);
      } else if (_currentInrWithinRange.localeCompare("Below") === 0) {
        _inrDiffBelowRange = Math.abs(inr - lowRange);
      }
      // % Days Within Range since last test
      if (_inrDiff === 0) {
        if (_currentInrWithinRange.localeCompare("In Range") === 0) {
          _percentageDaysWithinRangeSinceLastTest = 1;
        } else {
          _percentageDaysWithinRangeSinceLastTest = 0;
        }
      } else {
        _percentageDaysWithinRangeSinceLastTest = parseFloat(
          _inrDiffWithinRange / Math.abs(_inrDiff)
        );
      }
      // Days Within Range since last test
      _daysWithinRangeSinceLastTest = parseFloat(
        _percentageDaysWithinRangeSinceLastTest * _daysSinceLastTest
      ).toFixed(1);

      // ttr calculation
      let _daysWithinRange = 0;
      let _totalDays = 0;
      let _percentageDaysWithinRange = 0;

      let _totalNumberOfTests = 0;
      let _numberOfTestsInRange = 0;
      let _percentageOfTestsInRange = 0;

      console.log("inrRecordList", inrRecordList);
      for (let i = 0; i < inrRecordList.length; i++) {
        let record = inrRecordList[i];

        console.log("days", _daysWithinRange);
        console.log(
          "record.daysWithinRangeSinceLastTest",
          record.daysWithinRangeSinceLastTest
        );
        _daysWithinRange += record.daysWithinRangeSinceLastTest;
        _totalDays += record.daysSinceLastTest;
        if (record.currentInrWithinRange.localeCompare("In Range") === 0) {
          _numberOfTestsInRange += 1;
        }
      }
      // // Days Within Range
      // _daysWithinRange += _daysWithinRangeSinceLastTest;
      // // Total Days
      // _totalDays += _daysSinceLastTest;

      // % Days Within Range
      _percentageDaysWithinRange = _daysWithinRange / _totalDays;

      // % in Range
      // Total Number of Tests
      _totalNumberOfTests = inrRecordList.length;

      // Number of Tests in Range
      // if (_currentInrWithinRange.localeCompare("In Range") === 0) {
      //   _numberOfTestsInRange += 1;
      // }

      // % of Tests in Range
      _percentageOfTestsInRange = _numberOfTestsInRange / _totalNumberOfTests;

      console.log("Days Within Range: ", _daysWithinRange);
      console.log("Total days: ", _totalDays);
      console.log("% Days Within Range: ", _percentageDaysWithinRange);

      console.log("Total number of tests", _totalNumberOfTests);
      console.log("Number of tests in range", _numberOfTestsInRange);
      console.log("% Tests In Range: ", _percentageOfTestsInRange);

      setPercentageDaysWithinRange(_percentageDaysWithinRange);
      setPercentageOfTestsInRange(_percentageOfTestsInRange);

      // Rosendaal Method

      console.log(_daysSinceLastTest);
      console.log(_inrDiff);
      console.log(_previousInrWithinRange);
      console.log(_currentInrWithinRange);
      console.log(_scenario);
      console.log(_inrDiffAboveRange);
      console.log(_inrDiffWithinRange);
      console.log(_inrDiffBelowRange);
      console.log(_daysWithinRangeSinceLastTest);
      console.log(_percentageDaysWithinRangeSinceLastTest);
      // console.log("% Days Within Range: ", _percentageDaysWithinRange);
      // console.log("% Tests In Range: ", _percentageOfTestsInRange);

      setDaysSinceLastTest(_daysSinceLastTest);
      setInrDiff(_inrDiff);
      setPreviousInrWithinRange(_previousInrWithinRange);
      setCurrentInrWithinRange(_currentInrWithinRange);
      setScenario(_scenario);
      setInrDiffAboveRange(_inrDiffAboveRange);
      setInrDiffWithinRange(_inrDiffWithinRange);
      setInrDiffBelowRange(_inrDiffBelowRange);
      setDaysWithinRangeSinceLastTest(_daysWithinRangeSinceLastTest);
      setPercentageDaysWithinRangeSinceLastTest(
        _percentageDaysWithinRangeSinceLastTest
      );

      // setPercentageDaysWithinRange(_percentageDaysWithinRange);
      // setPercentageOfTestsInRange(_percentageOfTestsInRange);
    }
  }
